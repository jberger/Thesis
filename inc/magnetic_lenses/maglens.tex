\subsection{Motivation}
% montgomery_some_1961
% el-kareh_electron_1970

In many ways, an electron beam can be thought of in terms of an optical equivalent system. 
Of course there are notable exceptions; photons don't repel each other; photon energies are hard to change.
Electron optical systems do have an analogous system to the lens, in this case using magnetic fields rather than glass. 
The magnetic lens is a common element in electron microscopes and other electron-optical systems.
%TODO refs needed

Magnetic lenses present some challenges for Ultrafast Electron Microscopy.
First, the beams are likely to be much larger and thus a UEM will need large-aperture lenses.
Second, and more importantly, near a lens crossover (i.e. focus), the charge density can increase rapidly.
This charge density can lead to an unacceptable amount of space-charge interaction (see section \ref{sec:model_results}).

\subsection{Introduction to Magnetic Lenses}

A simple magnetic lens is just a solenoid.
The axis the lens is collinear with the axis of the microscope column.
Initially one would think that electrons moving parallel to this axis would not be affected by the magnetic field lines in the solenoid, however the contribution of the fringing field must be taken into consideration.
As electrons propagate through the solenoid the fringing magnetic field imparts an azimuthal velocity.
This ``tumbling'' around the axis, along with the axial magnetic field, is what causes the inward-directed force. 

A full description of the motion of the electrons is easily derived \cite{el-kareh_electron_1970},
\begin{subequations} \label{eq:lens_eq_of_motion}
\begin{gather}
  m \ddot{r} = -e B_z r \dot{\theta} + m r \dot{\theta}^2                 \\
  \frac{d}{dt} ( m r^2 \dot{\theta} ) = e r \dot{r} B_z - e r B_r \dot{z} \\
  m \ddot{z} = e B_r r \dot{\theta}
\end{gather}
\end{subequations}
however, attempting to further seperate these equations quickly highlights the tightly coupled nature of the motion of the electron in this system.
The full description of the off-axis field of a real (non-infinite) air-core solenoid is also surprisingly complicated.
Montgomery and Terrell \cite{montgomery_some_1961} provide a full treatment for many lens configurations, including a tractable treatment for a single current loop of radius $a$ in cylindrical coordinates, 
\begin{subequations} \label{eq:field_of_loop}
\begin{gather}
  H_z = \frac{2I}{\sqrt{Q}} \left(   F(k) + \frac{ a^2 - r^2 - z^2 }{ (1-k^2) Q } E(k) \right) \\
  H_r = \frac{2I}{\sqrt{Q}} \left( - F(k) + \frac{ a^2 + r^2 + z^2 }{ (1-k^2) Q } E(k) \right) \\
  Q \equiv (a+r)^2 + z^2 \\
  k \equiv \sqrt{ 4 a r / Q }
\end{gather}
\end{subequations}
%%TODO I can't decide whether the Q and k definitions should be numbered or not
%where
%\begin{gather*}
%  Q \equiv (a+r)^2 + z^2 \\
%  k \equiv \sqrt{ 4 a r / Q }
%\end{gather*}
and $F(k)$ and $E(k)$ are the complete elliptic integrals of the first and second kind respectively.
An even more accurate solenoid can be modeled by appropriately summing the fields of many such loops. 

\subsection{Design}

While in principle one could design a magnetic lens using \ref{eq:lens_eq_of_motion} and \ref{eq:field_of_loop}, the process wouldn't be very practical or instructive.
Further --- as suggested by the use of the $H$ field in \ref{eq:field_of_loop} --- better performance of the lens can be achieved by concentrating the field using materials with high magnetic permeablility.
These materials, called ``magnetic shielding'' since it captures the magnetic field lines, can direct the field lines to a small gap, known as the ``pole-piece gap''.
The field lines exit the shielding in the gap and it is this field that acts as the lens.
This gap can be much smaller than the total width of the coil turns, and yet contain in a field commensurate with the full coil.

\begin{figure}
\centering
\begin{tikzpicture}
  \foreach \n in {0,0.1,...,0.6}{
    \draw [red] (0.75,-0.5) ellipse [x radius=\n,y radius=0.6];
  }
  \foreach \n in {0,0.1,...,0.6}{
    \draw [red] (-0.75,-0.5) ellipse [x radius=\n,y radius=0.6];
  }
  \draw [fill=blue!50] 
    (-0.5,0)
    -- ++(0,2)
    -- ++(-2,0)
    -- ++(0,-5)
      node [pos=0.5,left,align=right] {Magnetic\\Shielding}
    -- ++(2,0)
    -- ++(0,2)
      coordinate [pos=0] (D left)
    -- ++(-0.5,0)
      coordinate [pos=0.5] (S top)
    -- ++(0,-1.5)
    -- ++(-1,0)
    -- ++(0,4)
    -- ++(1,0)
    -- ++(0,-1.5)
    -- ++(0.5,0)
      coordinate [pos=0.5] (S bottom)
    -- cycle
  ;
  \draw [fill=blue!50] 
    (0.5,0)
    -- ++(0,2)
    -- ++(2,0)
    -- ++(0,-5)
    -- ++(-2,0)
    -- ++(0,2)
      coordinate [pos=0] (D right)
    -- ++(0.5,0)
    -- ++(0,-1.5)
    -- ++(1,0)
    -- ++(0,4)
    -- ++(-1,0)
    -- ++(0,-1.5)
    -- cycle
  ;
  \draw [thick, dashed]
    (0,3)
    -- (0,-3)
      node [pos=0,above] {Axis of Electron Microscope Column}
  ;
  \draw [very thick,<->] 
    (S top) 
    -- (S bottom)
      node [pos=0.5,fill=white] {$S$}
  ;
  \draw [very thick,<->] 
    (D left) 
    -- (D right)
      node [below,pos=0.5,align=center] {$D$\\$(=2R)$}
  ;
  \node [rotate=90] at (-1.6,-0.5) {Windings};
  \node [red,rotate=90] at (1.6,-0.5) {Field Lines};
\end{tikzpicture}
\caption{Side-view schematic of a shielded magnetic lens with a pole-piece. The windings (current loops) are contained within the shielding. The magnetic field created by these windings is contained inside the shielding except in the gap.}
\end{figure}

El-Kareh and El-Kareh \cite{el-kareh_electron_1970} provide an analysis of symmetric lenses with magnetic shielding and a pole-piece in chapter 8, with the most useful information being in section 8.7.
They define
\begin{subequations}
\begin{gather}
  k^2 \equiv \frac{e}{8 m V_r} B_0^2 R^2 \\
  \beta \equiv k^2 V_r / (NI)^2 \label{eq:elkareh_k2}
\end{gather}
\end{subequations}
where $N$ is the number of loops, $I$ is the current in a single loop, $B_0$ is the maximum axial magnetic field strength, $R$ is the bore radius and $V_r$ is the relativity corrected acceleration potential, given by
\begin{equation}
  V_r = V ( 1 + \frac{0.978 \cdot 10^{-6}}{\text{Volt}} V )
\end{equation}
They then derive a number of formulae and tabulate the results for a variety of parameters.
Using these tabulated results, and for a choice of parameters one can determine the number of ampere-turns ($NI$) to create a certain focal length.

%TODO check S and D as I seem to remember we have S=0.1in
%TODO need a description of the steel inner tube causing an effective diameter larger than the actual bore
For the UEM, I chose a bore diameter $D$=0.3in and a pole-piece gap $S$=0.5in, for an ratio $S/D=0.6$.
By their table 8.2a this results in $\beta=0.0104$. Then, to create a focal length of 4in ($f/R=16$) table 8.17 gives a value for $k^2 \approx 0.05$.
Finally substituting this value into \ref{eq:elkareh_k2}, with $V=30$kV ($V_r\approx30.88$kV), one can deduce that $NI\approx385$A.

To further ease the burden on the lenses, I actually created two, one placed to either side of the RF cavity. As each has 100 turns, a current of only 2A is needed to drive the two lenses in series.


